<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="en">
<div th:replace="~{fragments :: head('FOG')}"></div>

<body>
<div th:replace="~{fragments :: top-nav}"></div>

<section>
  <h3>Order Details</h3>
 <div>
    <p>ID: <span th:text="${SessionOrder.id}"></span></p>
    <p>Dato: <span th:text="${SessionOrder.date}"></span></p>
    <p>User ID: <span th:text="${SessionOrder.user_id}"></span></p>
     <p>Name: <span th:text="${SessionOrder.name}"></span></p>
     <p>Email: <span th:text="${SessionOrder.email}"></span></p>
     <p>City: <span th:text="${SessionOrder.city}"></span></p>
    <p>Carport Længde: <span th:text="${SessionOrder.carport_length}"></span></p>
    <p>Carport Bredde: <span th:text="${SessionOrder.carport_width}"></span></p>
    <p>Skur Længde: <span th:text="${SessionOrder.shed_length}"></span></p>
    <p>Skur Bredde: <span th:text="${SessionOrder.shed_width}"></span></p>
    <p>Status: <span th:text="${SessionOrder.status}"></span></p>
     <div th:if="${orderlines}">
         <div th:each="orderline : ${orderlines}">
             <p>Orderline id: <span th:text="${orderline.id}"></span></p>
             <p>Materiale id: <span th:text="${orderline.material.id}"></span></p>
             <p>Antal: <span th:text="${orderline.quantity}"></span></p>
             <p>Pris på materialet: <span th:text="${orderline.total_price}"></span> kr</p>
         </div>
     </div>
  </div>

    <form id="updateStatusForm" th:action="@{/updateStatus}" method="post">
    <input type="hidden" name="orderId" th:value="${SessionOrder.id}"/>
    <label for="status">Ny Status:</label>
    <select name="status" id="status" required>
        <option value="Accepteret" th:selected="${SessionOrder.status == 'Accepteret'}">Accepteret</option>
        <option value="Betalt" th:selected="${SessionOrder.status == 'Betalt'}">Betalt</option>
        <option value="Pending" th:selected="${SessionOrder.status == 'Pending'}">Pending</option>
    </select>
    <button type="button" onclick="updateStatus()">Opdater Status</button>
  </form>
</section>


<script>
    function updateStatus() {
        var form = document.getElementById('updateStatusForm');
        var formData = new FormData(form);

        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/update-status', true);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
        xhr.send(new URLSearchParams(formData));

        // You can handle the response from the server here if needed
        xhr.onload = function () {
            if (xhr.status === 200) {
                var responseMessage = xhr.responseText;
                console.log(responseMessage);
                alert(responseMessage);
                location.reload();
            } else {
                console.error('Failed to update status');
            }
        };

        xhr.send(new URLSearchParams(formData));
    }
</script>
</body>

</html>
